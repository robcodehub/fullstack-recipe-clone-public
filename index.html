<html>
  <head>
    <script src='/dist/main.js' defer></script>

    <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.4/redux.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/react-redux/7.1.1/react-redux.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/react-router-dom/5.0.1/react-router-dom.js'></script>


    <style>

      body {
        font-family: helvetica;
      }

      nav {
        display: flex;
        justify-content: space-around;
      }
    </style>

  </head>
  <body>
    <div id='root'>
    </div>


    <script type='text/babel'>

    //root = div with id of root
    const root = document.querySelector('#root')
    //deconstructing from CDNs - less typing, less griping
    const { Component } = React;
    const { render } = ReactDOM;
    const { HashRouter, Link, Route} = ReactRouterDOM;
    const { createStore, combineReducers } = Redux;
    const { connect, Provider } = ReactRedux;

    //REDUX - ACTION TYPES
    const SET_RECIPES = 'SET_RECIPES'
    const SET_USERS = 'SET_USERS'


    const userReducer = (state = [], action) => {
      //ADD IF ACTION.TYPE HERE
      if (action.type === SET_USERS) {
        state = action.users;
      }
      return state;
    }

    const recipeReducer = (state = [], action) => {
      //ADD IF ACTION.TYPE HERE
      if (action.type === SET_RECIPES) {
        state = action.recipes;
      }
      return state;
    }


    //REDUX - COMBINE REDUCERS
    const reducer = combineReducers({
      users: userReducer,
      recipes: recipeReducer
    });

    //REDUX - CREATE REDUX STORE
      const store = createStore(reducer);


    //REDUX - AXIOS - FETCH RECIPES / USERS AND ADD TO STORE

    const fetchRecipes = async() => store.dispatch({type: SET_RECIPES, recipes: (await axios.get('/api/recipes')).data})

    const fetchUsers = async() => store.dispatch({type: SET_USERS, users: (await axios.get('/api/users')).data})


    const _Home = ({users, recipes}) => {
    return (
          <div>
            Welcome! {users.length} users and {recipes.length} recipes coming soon...
            <HealthyRecipes />
          </div>
        )
    }

    //HOME CONNECTED COMPONENT
    const Home = connect(({users, recipes}) => {
      return {
        users,
        recipes
      }
    })(_Home)

    const _Recipes = ({recipes}) => {
      const chefsTest = recipes.filter(recipe => recipe.user)
      console.log("RECIPES =======", recipes)
      console.log("RECIPES WITH CHEF =======", chefsTest)
      return (
        <div>
          {recipes.map(recipe => <div key = {recipe.id} > <br /> Name: {recipe.name} <br /> Cuisine: {recipe.cuisine} <br /> Health Score: {recipe.healthScore} <br /> Directions: {recipe.directions} <br /> Image: <br /> <img height="250" width="250" src={recipe.imageURL} /></div>)}
        </div>
      )
    }

    const Recipes = connect(({recipes}) => {
      return {
        recipes
      }
    })(_Recipes)



    const _Users = ({users}) => {
      return (
        <div>
          {users.length} Users coming soon...
          {users.map(user => <div key={user.id}> <br /> Chef Name: {user.username} <br /> Chef Score: {user.chefScore} <br /> Profile Image: <br /> <img height="150" width="150" src={user.imageURL} /> <br /></div>)}
        </div>
      )
    }

    const Users = connect(({users}) => {
      return {
        users
      }
    })(_Users);

    const _Nav = ({recipes, users}) => {
      return (
        <nav>
          <Link to='/'> Home </Link>
          <Link to='/users'> Users ({users.length}) </Link>
          <Link to='/recipes'> Recipes ({recipes.length})</Link>
          <Link to='/chefs'> Chefs ({(recipes.filter(recipe => recipe.userId !== null)).length})</Link>
        </nav>
      )
    }

    const Nav = connect(({recipes, users}) => {
      return {
        recipes,
        users
      }
    })(_Nav)

    //{recipes.filter(recipe => recipe.user)}
    const _Chefs = ({recipes, users}) => {
      return (
        <div>
          Chefs coming soon...
        </div>
      )
    }

    const Chefs = connect(({recipes, users}) => {
      return {
        recipes,
        users
      }
    })(_Chefs)


    const _HealthyRecipes = ({recipes, users}) => {
      const healthyFood = recipes.filter(recipe => recipe.healthScore >= 8)
      console.log("HEALTHY FOOD====", healthyFood)
      return (
        <div>
          <br />
        There are {healthyFood.length} healthy recipes including {healthyFood.map(food => <p key ={food.name}>{food.name} </p>) }
        <br />

        </div>
      )
    }

    const HealthyRecipes = connect(({recipes, users}) => {
      return {
        recipes,
        users
      }
    })(_HealthyRecipes)


    /*
    const _TopChef = ({recipes, users}) => {

      //create array of objects for users with recipes
      //let chefUsers = users.filter(user => user.recipe)

     // console.log("users with recipes =====", chefUsers)
      let topScore = [{chefScore: 0}];
      for (let i=0; i<users.length; i++) {
        if (users[i].recipe) {
          if(users.chefScore > topScore.chefScore) {
            topScore = users[i];
          }
      }
    }
    //return topScore;

    /*
    let topChef = users;
      console.log("Top Chef initial check", topChef[0])
      const theTopChef = users.forEach(user => {
        if(user.score > topChef.score) {
          return user
        }
      });

      return (
        <div>
          The top Chef is {topScore.name}
        </div>
      )
    }


    const TopChef = connect(({recipes, users}) => {
      return {
        recipes,
        users
      }
    })(_TopChef)

    */



    class App extends Component {
      constructor() {
        super()
        this.state = {
        }
      }

      componentDidMount() {
        fetchRecipes();
        fetchUsers();
      }

      render() {
        return (
          <HashRouter>
            <Route component = {Nav} />
            <Route path = '/' component = { Home } exact />
            <Route path = '/users' component = { Users } />
            <Route path = '/recipes' component = { Recipes } />
            <Route path = '/chefs' component = { Chefs } />
          </HashRouter>
        )
      }
    }

    render(<Provider store={store}><App /></Provider>, root)

    </script>
  </body>
</html>
